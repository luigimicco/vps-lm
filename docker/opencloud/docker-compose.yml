networks:
  reverse-proxy:
    external: true

volumes:
  opencloud_data:
    external: true
  opencloud_config:
    external: true

services:
  opencloud:
    container_name: opencloud
    hostname: opencloud
    image: opencloudeu/opencloud-rolling:latest
    entrypoint:
      - /bin/sh
    networks:
      - reverse-proxy
    command: ["-c", "opencloud init || true; opencloud server"]
    environment:
      PROXY_HTTP_ADDR: "0.0.0.0:9200"
      # change to the public domain name of your OpenCloud instance with protocol and port
      OC_URL: https://opencloud.luigimicco.it:9200
      OC_LOG_LEVEL: info
      # uncomment if you do not want use SSL between the reverse proxy and OpenCloud
      # PROXY_TLS: "false"
      # INSECURE: needed if OpenCloud is using self generated certificates
      OC_INSECURE: "true"
      # basic auth (not recommended, but needed for eg. WebDav clients that do not support OpenID Connect)
      PROXY_ENABLE_BASIC_AUTH: "false"
      # admin user password
      IDM_ADMIN_PASSWORD: "admin" # this overrides the admin password from the configuration file
      # demo users
      # IDM_CREATE_DEMO_USERS: "true"    
    ports:
      - 9200:9200
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro"
      - opencloud_data:/var/lib/opencloud
      - opencloud_config:/etc/opencloud
      # - "certs:/certs"
    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    logging:
      driver: local
    restart: unless-stopped

